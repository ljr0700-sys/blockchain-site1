<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>부동산 자산 디지털화 플랫폼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050816;
      color: #f5f5f5;
      line-height: 1.6;
    }
    a { color: #ffd36b; text-decoration: none; }
    a:hover { text-decoration: underline; }

    header {
      padding: 18px 20px 10px;
      background: linear-gradient(135deg, #1555ff, #26a5ff);
      color: #fff;
    }
    header h1 {
      margin: 0 0 6px;
      font-size: 22px;
    }
    header p {
      margin: 0;
      font-size: 13px;
      opacity: 0.9;
    }

    .nav-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 10px 20px 14px;
      background: #040814;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .nav-bar button {
      border: none;
      padding: 7px 12px;
      border-radius: 18px;
      background: #111827;
      color: #d1d5db;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }
    .nav-bar button.active {
      background: #1f6bff;
      color: #fff;
      font-weight: 600;
    }

    .top-status {
      margin-left: auto;
      font-size: 12px;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .tag {
      display: inline-block;
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      margin-left: 4px;
    }

    main {
      max-width: 1080px;
      margin: 12px auto 40px;
      padding: 0 16px;
    }
    .page-section {
      display: none;
      background: radial-gradient(circle at top left, #1f2937 0, #020617 60%);
      border-radius: 12px;
      padding: 18px 18px 22px;
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 18px 40px rgba(15,23,42,0.6);
    }
    .page-section.active {
      display: block;
    }

    h2 {
      margin-top: 0;
      font-size: 20px;
      margin-bottom: 8px;
    }
    h3 {
      margin-top: 18px;
      margin-bottom: 6px;
      font-size: 15px;
    }
    p { font-size: 13px; margin: 4px 0 8px; }
    ul { padding-left: 18px; margin: 4px 0 10px; font-size: 13px; }

    .notice {
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 8px;
      background: rgba(15,23,42,0.85);
      border: 1px dashed rgba(248,250,252,0.25);
      margin: 6px 0 12px;
    }

    form {
      margin: 8px 0 14px;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
    }
    label {
      display: block;
      font-size: 12px;
      margin-top: 6px;
      margin-bottom: 2px;
    }
    input, select, textarea {
      width: 100%;
      padding: 6px 7px;
      border-radius: 6px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      font-size: 12px;
    }
    textarea { resize: vertical; min-height: 60px; }

    button.btn {
      margin-top: 8px;
      padding: 6px 11px;
      border-radius: 999px;
      border: none;
      background: #1f6bff;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }
    button.btn.sub {
      background: #334155;
    }

    .two-col {
      display: grid;
      grid-template-columns: minmax(0,1.1fr) minmax(0,1fr);
      gap: 16px;
    }
    .chip {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(37,99,235,0.22);
      border: 1px solid rgba(59,130,246,0.6);
      margin-right: 4px;
      margin-bottom: 3px;
    }

    .tab-row {
      display: flex;
      gap: 6px;
      margin: 8px 0 12px;
      flex-wrap: wrap;
    }
    .tab-row button {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: transparent;
      color: #e5e7eb;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    .tab-row button.active {
      background: #1f6bff;
      border-color: #1f6bff;
    }

    .table-like {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 4px;
    }
    .table-like th,
    .table-like td {
      border: 1px solid rgba(148,163,184,0.4);
      padding: 4px 6px;
      text-align: left;
    }
    .table-like th {
      background: rgba(15,23,42,0.9);
      font-weight: 600;
    }

    .code-block {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: rgba(17,24,39,0.95);
      padding: 7px 8px;
      border-radius: 8px;
      border: 1px solid rgba(30,64,175,0.8);
      overflow-x: auto;
      white-space: pre-wrap;
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148,163,184,0.6);
      margin-right: 4px;
      margin-bottom: 3px;
    }

    @media (max-width: 720px) {
      header h1 { font-size: 18px; }
      .two-col { grid-template-columns: minmax(0,1fr); }
      .nav-bar { padding-bottom: 10px; }
    }
  </style>
</head>
<body>
<header>
  <h1>부동산 자산 디지털화 플랫폼</h1>
  <p>
    부동산 정보 입력 → 토큰/코인 구조 설계 → 블록체인 기록까지 한 번에 체험해 보는 사이트입니다.
    <span class="tag">아이디어·구조 확인용 데모</span>
  </p>
</header>

<nav class="nav-bar">
  <button class="nav-btn active" data-section="home">홈(개요)</button>
  <button class="nav-btn" data-section="signup">회원가입·로그인</button>
  <button class="nav-btn" data-section="trade">매매·임대</button>
  <button class="nav-btn" data-section="swap">바꿔 살아 보기</button>
  <button class="nav-btn" data-section="chain">부동산 자산 디지털화 체험(3단계)</button>
  <button class="nav-btn" data-section="project">가상 건축 프로젝트</button>
  <button class="nav-btn" data-section="ads">광고주 계정</button>
  <button class="nav-btn" data-section="mypage">마이페이지</button>

  <div class="top-status" id="top-status">
    현재 로그인: 없음
  </div>
</nav>

<main>
  <!-- 홈 -->
  <section id="home" class="page-section active">
    <h2>1. 플랫폼 개요</h2>
    <div class="notice">
      ⚠️ 이 사이트는 <strong>연습·데모용</strong>입니다.  
      입력한 정보와 생성된 블록/코인 데이터는 <strong>이 PC 브라우저(LocalStorage)</strong> 안에만 저장되며,
      실제 투자·거래 서비스와는 아무 관련이 없습니다.
    </div>
    <p>
      이 페이지는 부동산을 디지털 토큰(코인)으로 표현했을 때의 흐름과 구조를 눈으로 확인해 보는 개인용 플랫폼입니다.
      회원가입 후 하나의 계정으로 <span class="chip">부동산 정보 입력</span>
      <span class="chip">매매·임대/바꿔살기 등록</span>
      <span class="chip">블록체인 기록 생성</span>
      <span class="chip">토큰/코인 집계</span> 까지 모두 이어서 체험할 수 있습니다.
    </p>

    <h3>이 사이트에서 해보는 것</h3>
    <ul>
      <li>회원가입·로그인을 해서 <strong>개인 연습 계정</strong>을 만든다.</li>
      <li><strong>매매·임대 / 바꿔 살아 보기</strong> 메뉴에서 내가 가진 부동산 정보와 연락처를 입력한다.</li>
      <li><strong>부동산 자산 디지털화 체험(3단계)</strong>에서 입력된 내용을 블록체인 구조로 기록해 본다.</li>
      <li><strong>마이페이지</strong>에서 나에게 지급된 토큰/코인·암호화폐를 한 번에 확인한다.</li>
    </ul>

    <h3>데이터 보관 방식</h3>
    <p>
      모든 정보는 이 브라우저의 <strong>LocalStorage</strong>에만 저장됩니다.
      같은 컴퓨터·같은 브라우저로 다시 접속하면, 이전에 입력한 연습 데이터가 계속 유지될 수 있습니다.
      (다른 브라우저나 다른 PC에서는 보이지 않습니다.)
    </p>
  </section>

  <!-- 회원가입 & 로그인 -->
  <section id="signup" class="page-section">
    <h2>2. 회원가입 · 로그인</h2>
    <p>
      이곳에서 <strong>연습용 계정</strong>을 만들고 로그인합니다.
      예시 계정 <code>jung / sam377</code> 도 미리 준비되어 있습니다.
    </p>

    <div class="two-col">
      <div>
        <h3>회원가입</h3>
        <form id="form-signup">
          <label>아이디</label>
          <input type="text" id="su-id" required />

          <label>비밀번호</label>
          <input type="password" id="su-pw" required />

          <label>이름</label>
          <input type="text" id="su-name" />

          <label>연락처(휴대폰)</label>
          <input type="text" id="su-phone" />

          <label>이메일</label>
          <input type="email" id="su-email" />

          <button type="submit" class="btn">회원가입</button>
        </form>
      </div>

      <div>
        <h3>로그인</h3>
        <form id="form-login">
          <label>아이디</label>
          <input type="text" id="li-id" placeholder="예: jung" required />

          <label>비밀번호</label>
          <input type="password" id="li-pw" placeholder="예: sam377" required />

          <button type="submit" class="btn">로그인</button>
          <button type="button" class="btn sub" id="btn-logout">로그아웃</button>
        </form>

        <div class="notice" id="login-info">
          현재 로그인: 없음
        </div>
      </div>
    </div>
  </section>

  <!-- 매매·임대 -->
  <section id="trade" class="page-section">
    <h2>3. 매매 · 임대 등록</h2>
    <p>
      회원이 보유한 부동산의 매매/전세/월세/펜션 정보를 등록합니다.
      등록할 때마다 <strong>블록체인 기록</strong>이 1개 추가되고,
      그 블록의 <strong>해시값과 연결된 코인</strong>이 자동으로 지급됩니다.
    </p>

    <form id="form-trade">
      <label>부동산 이름 또는 간단한 제목</label>
      <input type="text" id="trade-title" required />

      <label>주소</label>
      <input type="text" id="trade-address" required />

      <label>거래 유형</label>
      <select id="trade-type">
        <option value="매매">매매</option>
        <option value="전세">전세</option>
        <option value="월세">월세</option>
        <option value="펜션">펜션 임대</option>
      </select>

      <label>가격 / 보증금 / 월세 등</label>
      <input type="text" id="trade-price" />

      <label>연락처(전화 또는 메신저)</label>
      <input type="text" id="trade-contact" />

      <label>추가 설명</label>
      <textarea id="trade-note" placeholder="옵션, 입주 가능일, 특징 등을 적어 보세요."></textarea>

      <button type="submit" class="btn">매물 등록 + 블록·코인 생성</button>
    </form>

    <div id="trade-list"></div>
  </section>

  <!-- 바꿔 살아 보기 -->
  <section id="swap" class="page-section">
    <h2>4. 바꿔 살아 보기 계정</h2>
    <p>
      서로의 집이나 펜션 등을 일정 기간 동안 교환해서 살아보는 시나리오를 위한 메뉴입니다.
      등록할 때마다 <strong>교환 제안 블록</strong>과 함께 <strong>코인</strong>이 생성됩니다.
    </p>

    <form id="form-swap">
      <label>내 집 / 공간 이름</label>
      <input type="text" id="swap-my-title" required />

      <label>내 집 위치</label>
      <input type="text" id="swap-my-location" />

      <label>바꾸고 싶은 지역 또는 조건</label>
      <input type="text" id="swap-wish" placeholder="예: 부산 바다 근처, 2주 정도" />

      <label>가능 기간</label>
      <input type="text" id="swap-period" placeholder="예: 2026년 1월~2월 중 2주" />

      <label>연락처</label>
      <input type="text" id="swap-contact" />

      <label>추가 설명</label>
      <textarea id="swap-note"></textarea>

      <button type="submit" class="btn">교환 제안 등록 + 블록·코인 생성</button>
    </form>

    <div id="swap-list"></div>
  </section>

  <!-- 3단계 체험 + 블록체인 -->
  <section id="chain" class="page-section">
    <h2>5. 부동산 자산 디지털화 체험 (3단계)</h2>

    <div class="tab-row">
      <button class="chain-tab active" data-step="1">1단계: 개념 설명</button>
      <button class="chain-tab" data-step="2">2단계: 부동산 정보 입력</button>
      <button class="chain-tab" data-step="3">3단계: 블록체인 기록 보기</button>
    </div>

    <div id="chain-step-1">
      <p>
        이 단계에서는 <strong>“부동산을 토큰으로 쪼개서, 거래 이력은 블록체인처럼 이어 붙이면 어떤 느낌일까?”</strong>
        를 이해하는 데 초점을 둡니다.
      </p>
      <ul>
        <li>각 회원에게는 연습용 토큰/코인이 부여됩니다.</li>
        <li>부동산 기본 정보, 매매·임대, 바꿔 살아 보기 등록을 할 때마다 <strong>블록 1개</strong>가 생성됩니다.</li>
        <li>각 블록에는 <strong>고유 해시값</strong>이 있고, 같은 해시값을 참조하는 <strong>코인(암호화폐)</strong>이 함께 만들어집니다.</li>
        <li>모든 기록은 <strong>마이페이지</strong>에서 다시 확인할 수 있습니다.</li>
      </ul>
    </div>

    <div id="chain-step-2" style="display:none;">
      <h3>2단계: 부동산 기본 정보 입력</h3>
      <p>
        회원이 보유한 대표 부동산 1개를 가정하고, 아래 내용을 입력합니다.
        저장 버튼을 누르면 <strong>“부동산 등록” 블록</strong>과 함께 <strong>기본 토큰</strong>이 발행됩니다.
      </p>

      <form id="form-property">
        <label>부동산 이름 (예: OO동 OO아파트 101동 1001호)</label>
        <input type="text" id="prop-title" />

        <label>주소</label>
        <input type="text" id="prop-address" />

        <label>예상 시가 / 기준 금액</label>
        <input type="text" id="prop-value" placeholder="예: 1,000,000,000원" />

        <label>요약 설명</label>
        <textarea id="prop-note" placeholder="층수, 구조, 면적, 특징 등을 적어 보세요."></textarea>

        <button type="submit" class="btn">부동산 정보 저장 + 블록·코인 생성</button>
      </form>
    </div>

    <div id="chain-step-3" style="display:none;">
      <h3>3단계: 블록체인 기록 확인</h3>
      <p>
        지금까지 이 계정에서 만든 <strong>모든 블록</strong>을 확인합니다.
        각 블록에는 <strong>해시값</strong>과 <strong>이전 해시값</strong>이 들어 있어,
        단순한 형태의 블록체인 구조를 눈으로 볼 수 있습니다.
      </p>

      <button type="button" class="btn sub" id="btn-refresh-chain">블록 목록 새로고침</button>

      <div id="chain-view" class="code-block" style="margin-top:8px;">
        아직 생성된 블록이 없습니다. (회원가입 후 부동산 등록·매물 등록·바꿔살기 등록을 해 보세요.)
      </div>
    </div>
  </section>

  <!-- 가상 건축 프로젝트 -->
  <section id="project" class="page-section">
    <h2>6. 가상 건축 프로젝트</h2>
    <p>
      이 메뉴에서는 실제 부지를 갖고 있다고 가정하고, <strong>가상 건축 계획</strong>을 텍스트로 정리해 둘 수 있습니다.
      (이 데이터는 현재 블록체인 기록에는 포함되지 않지만, 향후 확장 시 연결할 수 있습니다.)
    </p>

    <form id="form-project">
      <label>프로젝트 이름</label>
      <input type="text" id="proj-title" />

      <label>위치 / 용도</label>
      <input type="text" id="proj-location" placeholder="예: ○○시 ○○동, 근린생활시설 + 원룸" />

      <label>개발 개요</label>
      <textarea id="proj-outline" placeholder="층수, 세대수, 상가 구성, 예상 임대료 구조 등을 적어 보세요."></textarea>

      <button type="submit" class="btn">프로젝트 메모 저장</button>
    </form>

    <div id="proj-view"></div>
  </section>

  <!-- 광고주 계정 -->
  <section id="ads" class="page-section">
    <h2>7. 광고주 계정</h2>
    <p>
      이 영역은 향후 <strong>플랫폼 운영자(관리자)</strong>가 사용할 수 있는 광고·후원 영역을 가정한 곳입니다.
      현재는 각 광고주의 기본 정보만 연습으로 저장해 둘 수 있습니다.
    </p>

    <form id="form-ads">
      <label>광고주 이름 / 업체명</label>
      <input type="text" id="ads-name" />

      <label>연락처</label>
      <input type="text" id="ads-contact" />

      <label>광고 내용 / 링크</label>
      <textarea id="ads-note"></textarea>

      <button type="submit" class="btn">광고주 정보 저장</button>
    </form>

    <div id="ads-list"></div>
  </section>

  <!-- 마이페이지 -->
  <section id="mypage" class="page-section">
    <h2>8. 마이페이지 · 토큰/코인 집계</h2>
    <p>
      현재 로그인한 회원 기준으로, <strong>등록된 부동산·매물</strong>과
      <strong>발행된 블록·코인(암호화폐)</strong>을 한 눈에 확인합니다.
    </p>

    <div id="mypage-summary" class="notice">
      로그인 후 이용해 주세요.
    </div>

    <h3>토큰/코인 구조 (연습용 예시)</h3>
    <ul>
      <li>총 발행 한도(예시): 10,000 코인</li>
      <li>부동산 기본 정보 등록 시: 1,000 코인 지급</li>
      <li>매매·임대 매물 1건 등록 시: 100 코인 지급</li>
      <li>바꿔 살아 보기 제안 1건 등록 시: 50 코인 지급</li>
      <li>각 코인의 ID는 연결된 <strong>블록 해시값</strong>에서 파생되어 만들어집니다.</li>
    </ul>

    <h3>보유 코인 목록</h3>
    <div id="coin-table-wrap"></div>

    <h3>블록 요약</h3>
    <div id="mypage-blocks" class="code-block"></div>
  </section>
</main>

<script>
  // -------- 공통 유틸 --------
  const STORAGE_KEYS = {
    USERS: "bcs_users_v1",
    CURRENT: "bcs_current_user_v1"
  };

  function loadUsers() {
    try {
      const raw = localStorage.getItem(STORAGE_KEYS.USERS);
      if (!raw) return {};
      return JSON.parse(raw);
    } catch (e) {
      console.error(e);
      return {};
    }
  }

  function saveUsers(users) {
    localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
  }

  function getCurrentUserId() {
    return localStorage.getItem(STORAGE_KEYS.CURRENT) || null;
  }

  function setCurrentUserId(id) {
    if (id) localStorage.setItem(STORAGE_KEYS.CURRENT, id);
    else localStorage.removeItem(STORAGE_KEYS.CURRENT);
  }

  function getCurrentUser(users) {
    const id = getCurrentUserId();
    if (!id) return null;
    return users[id] || null;
  }

  function ensureUserShape(u) {
    // 필요한 필드가 없으면 만들어 줌(기존 데이터 보호)
    if (!u.state) u.state = {};
    const s = u.state;
    if (!s.property) s.property = null;
    if (!Array.isArray(s.trades)) s.trades = [];
    if (!Array.isArray(s.swaps)) s.swaps = [];
    if (!Array.isArray(s.blocks)) s.blocks = [];
    if (!Array.isArray(s.coins)) s.coins = [];
    if (!s.project) s.project = null;
    if (!Array.isArray(s.ads)) s.ads = [];
  }

  function simpleHash(str) {
    let h = 0;
    for (let i = 0; i < str.length; i++) {
      h = (h * 31 + str.charCodeAt(i)) >>> 0;
    }
    return "H" + h.toString(16);
  }

  function addBlockForUser(user, type, payload) {
    ensureUserShape(user);
    const blocks = user.state.blocks;
    const index = blocks.length;
    const timestamp = new Date().toISOString();
    const prevHash = index === 0 ? "GENESIS" : blocks[index - 1].hash;
    const dataStr = JSON.stringify({ type, payload });
    const hash = simpleHash(index + timestamp + prevHash + dataStr);

    const block = { index, timestamp, type, payload, prevHash, hash };
    blocks.push(block);

    // 코인 발행 규칙
    let amount = 0;
    if (type === "property") amount = 1000;
    else if (type === "trade") amount = 100;
    else if (type === "swap") amount = 50;

    if (amount > 0) {
      const coin = {
        id: "C" + hash.slice(-8),
        blockHash: hash,
        amount,
        type,
        createdAt: timestamp
      };
      user.state.coins.push(coin);
    }
  }

  function updateTopStatus(users) {
    const el = document.getElementById("top-status");
    const u = getCurrentUser(users);
    if (!u) {
      el.textContent = "현재 로그인: 없음";
    } else {
      el.textContent =
        "현재 로그인: " +
        (u.name || u.id) +
        " (아이디: " +
        u.id +
        ")";
    }
  }

  function switchSection(targetId) {
    document
      .querySelectorAll(".page-section")
      .forEach((sec) => sec.classList.remove("active"));
    const t = document.getElementById(targetId);
    if (t) t.classList.add("active");

    document
      .querySelectorAll(".nav-btn")
      .forEach((btn) => btn.classList.remove("active"));
    const nav = document.querySelector(
      '.nav-btn[data-section="' + targetId + '"]'
    );
    if (nav) nav.classList.add("active");
  }

  // -------- 초기 세팅 --------
  let users = loadUsers();

  // 예시 계정 jung/sam377이 없다면 생성
  if (!users["jung"]) {
    users["jung"] = {
      id: "jung",
      password: "sam377",
      name: "예시 계정 jung",
      phone: "",
      email: "",
      state: {
        property: null,
        trades: [],
        swaps: [],
        blocks: [],
        coins: [],
        project: null,
        ads: []
      }
    };
    saveUsers(users);
  }

  updateTopStatus(users);

  // -------- 메뉴 클릭 --------
  document.querySelectorAll(".nav-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const sec = btn.dataset.section;
      switchSection(sec);
      if (sec === "mypage") renderMyPage();
      if (sec === "trade") renderTrades();
      if (sec === "swap") renderSwaps();
      if (sec === "project") renderProject();
      if (sec === "ads") renderAds();
    });
  });

  // -------- 회원가입 --------
  document
    .getElementById("form-signup")
    .addEventListener("submit", (e) => {
      e.preventDefault();
      const id = document.getElementById("su-id").value.trim();
      const pw = document.getElementById("su-pw").value;
      const name = document.getElementById("su-name").value.trim();
      const phone = document.getElementById("su-phone").value.trim();
      const email = document.getElementById("su-email").value.trim();

      if (!id || !pw) {
        alert("아이디와 비밀번호를 입력해 주세요.");
        return;
      }
      if (users[id]) {
        alert("이미 존재하는 아이디입니다.");
        return;
      }
      users[id] = {
        id,
        password: pw,
        name,
        phone,
        email,
        state: {
          property: null,
          trades: [],
          swaps: [],
          blocks: [],
          coins: [],
          project: null,
          ads: []
        }
      };
      saveUsers(users);
      alert("회원가입이 완료되었습니다. 이제 로그인해 주세요.");
      document.getElementById("form-signup").reset();
    });

  // -------- 로그인 / 로그아웃 --------
  function refreshLoginInfo() {
    const u = getCurrentUser(users);
    const box = document.getElementById("login-info");
    if (!u) {
      box.textContent = "현재 로그인: 없음";
    } else {
      box.textContent =
        "현재 로그인: " +
        (u.name || u.id) +
        " (아이디: " +
        u.id +
        ")";
    }
    updateTopStatus(users);
  }

  document
    .getElementById("form-login")
    .addEventListener("submit", (e) => {
      e.preventDefault();
      const id = document.getElementById("li-id").value.trim();
      const pw = document.getElementById("li-pw").value;

      const u = users[id];
      if (!u || u.password !== pw) {
        alert("아이디 또는 비밀번호가 올바르지 않습니다.");
        return;
      }
      setCurrentUserId(id);
      refreshLoginInfo();
      alert("로그인되었습니다.");
    });

  document
    .getElementById("btn-logout")
    .addEventListener("click", () => {
      setCurrentUserId(null);
      refreshLoginInfo();
      alert("로그아웃되었습니다.");
    });

  refreshLoginInfo();

  function requireLogin() {
    const u = getCurrentUser(users);
    if (!u) {
      alert("먼저 회원가입·로그인 메뉴에서 로그인해 주세요.");
      return null;
    }
    ensureUserShape(u);
    return u;
  }

  // -------- 매매·임대 --------
  function renderTrades() {
    const wrap = document.getElementById("trade-list");
    const u = getCurrentUser(users);
    if (!u) {
      wrap.innerHTML = '<div class="notice">로그인 후 사용 가능합니다.</div>';
      return;
    }
    ensureUserShape(u);
    if (!u.state.trades.length) {
      wrap.innerHTML =
        '<div class="notice">등록된 매매·임대 정보가 없습니다.</div>';
      return;
    }
    let html =
      '<table class="table-like"><thead><tr><th>제목</th><th>유형</th><th>가격</th><th>연락처</th></tr></thead><tbody>';
    u.state.trades.forEach((t) => {
      html +=
        "<tr><td>" +
        (t.title || "") +
        "</td><td>" +
        t.type +
        "</td><td>" +
        (t.price || "") +
        "</td><td>" +
        (t.contact || "") +
        "</td></tr>";
    });
    html += "</tbody></table>";
    wrap.innerHTML = html;
  }

  document
    .getElementById("form-trade")
    .addEventListener("submit", (e) => {
      e.preventDefault();
      const u = requireLogin();
      if (!u) return;

      const title = document.getElementById("trade-title").value.trim();
      const address = document.getElementById("trade-address").value.trim();
      const type = document.getElementById("trade-type").value;
      const price = document.getElementById("trade-price").value.trim();
      const contact = document.getElementById("trade-contact").value.trim();
      const note = document.getElementById("trade-note").value.trim();

      if (!title || !address) {
        alert("제목과 주소를 입력해 주세요.");
        return;
      }

      ensureUserShape(u);
      const trade = {
        title,
        address,
        type,
        price,
        contact,
        note,
        createdAt: new Date().toISOString()
      };
      u.state.trades.push(trade);
      addBlockForUser(u, "trade", trade);
      saveUsers(users);
      alert("매물이 등록되고, 블록·코인이 생성되었습니다.");
      document.getElementById("form-trade").reset();
      renderTrades();
    });

  // -------- 바꿔 살아 보기 --------
  function renderSwaps() {
    const wrap = document.getElementById("swap-list");
    const u = getCurrentUser(users);
    if (!u) {
      wrap.innerHTML = '<div class="notice">로그인 후 사용 가능합니다.</div>';
      return;
    }
    ensureUserShape(u);
    if (!u.state.swaps.length) {
      wrap.innerHTML =
        '<div class="notice">등록된 교환 제안이 없습니다.</div>';
      return;
    }
    let html =
      '<table class="table-like"><thead><tr><th>내 집</th><th>희망 조건</th><th>기간</th><th>연락처</th></tr></thead><tbody>';
    u.state.swaps.forEach((s) => {
      html +=
        "<tr><td>" +
        (s.myTitle || "") +
        "</td><td>" +
        (s.wish || "") +
        "</td><td>" +
        (s.period || "") +
        "</td><td>" +
        (s.contact || "") +
        "</td></tr>";
    });
    html += "</tbody></table>";
    wrap.innerHTML = html;
  }

  document
    .getElementById("form-swap")
    .addEventListener("submit", (e) => {
      e.preventDefault();
      const u = requireLogin();
      if (!u) return;

      const myTitle = document
        .getElementById("swap-my-title")
        .value.trim();
      const myLocation = document
        .getElementById("swap-my-location")
        .value.trim();
      const wish = document.getElementById("swap-wish").value.trim();
      const period = document.getElementById("swap-period").value.trim();
      const contact = document
        .getElementById("swap-contact")
        .value.trim();
      const note = document.getElementById("swap-note").value.trim();

      if (!myTitle) {
        alert("내 집/공간 이름을 입력해 주세요.");
        return;
      }

      ensureUserShape(u);
      const swap = {
        myTitle,
        myLocation,
        wish,
        period,
        contact,
        note,
        createdAt: new Date().toISOString()
      };
      u.state.swaps.push(swap);
      addBlockForUser(u, "swap", swap);
      saveUsers(users);
      alert("교환 제안이 등록되고, 블록·코인이 생성되었습니다.");
      document.getElementById("form-swap").reset();
      renderSwaps();
    });

  // -------- 체험 2단계: 부동산 기본 --------
  document
    .getElementById("form-property")
    .addEventListener("submit", (e) => {
      e.preventDefault();
      const u = requireLogin();
      if (!u) return;

      const title = document.getElementById("prop-title").value.trim();
      const address = document.getElementById("prop-address").value.trim();
      const value = document.getElementById("prop-value").value.trim();
      const note = document.getElementById("prop-note").value.trim();

      if (!title) {
        alert("부동산 이름을 입력해 주세요.");
        return;
      }

      ensureUserShape(u);
      const prop = {
        title,
        address,
        value,
        note,
        updatedAt: new Date().toISOString()
      };
      u.state.property = prop;
      addBlockForUser(u, "property", prop);
      saveUsers(users);
      alert("부동산 정보가 저장되고, 블록·코인이 생성되었습니다.");
      document.getElementById("form-property").reset();
    });

  // -------- 체험 3단계: 블록 보기 --------
  function renderChainView() {
    const box = document.getElementById("chain-view");
    const u = getCurrentUser(users);
    if (!u) {
      box.textContent = "로그인 후 이용해 주세요.";
      return;
    }
    ensureUserShape(u);
    if (!u.state.blocks.length) {
      box.textContent =
        "아직 생성된 블록이 없습니다. 부동산 정보/매매·임대/바꿔살기 등록을 먼저 해 보세요.";
      return;
    }
    let out = "";
    u.state.blocks.forEach((b) => {
      out +=
        "[" +
        b.index +
        "] " +
        b.type.toUpperCase() +
        " | " +
        b.timestamp +
        "\n";
      out += "  hash:     " + b.hash + "\n";
      out += "  prevHash: " + b.prevHash + "\n";
      out +=
        "  data: " +
        JSON.stringify(b.payload, null, 2).replace(/\n/g, "\n        ") +
        "\n\n";
    });
    box.textContent = out;
  }

  document
    .getElementById("btn-refresh-chain")
    .addEventListener("click", renderChainView);

  // -------- 체험 탭 전환 --------
  document.querySelectorAll(".chain-tab").forEach((btn) => {
    btn.addEventListener("click", () => {
      const step = btn.dataset.step;
      document
        .querySelectorAll(".chain-tab")
        .forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");

      document.getElementById("chain-step-1").style.display =
        step === "1" ? "block" : "none";
      document.getElementById("chain-step-2").style.display =
        step === "2" ? "block" : "none";
      document.getElementById("chain-step-3").style.display =
        step === "3" ? "block" : "none";

      if (step === "3") renderChainView();
    });
  });

  // -------- 가상 건축 --------
  function renderProject() {
    const wrap = document.getElementById("proj-view");
    const u = getCurrentUser(users);
    if (!u) {
      wrap.innerHTML =
        '<div class="notice">로그인 후 프로젝트 메모를 저장할 수 있습니다.</div>';
      return;
    }
    ensureUserShape(u);
    if (!u.state.project) {
      wrap.innerHTML =
        '<div class="notice">저장된 프로젝트 메모가 없습니다.</div>';
      return;
    }
    const p = u.state.project;
    wrap.innerHTML =
      '<div class="code-block">' +
      "프로젝트 이름: " +
      (p.title || "") +
      "\n위치/용도: " +
      (p.location || "") +
      "\n\n개발 개요:\n" +
      (p.outline || "") +
      "</div>";
  }

  document
    .getElementById("form-project")
    .addEventListener("submit", (e) => {
      e.preventDefault();
      const u = requireLogin();
      if (!u) return;

      const title = document.getElementById("proj-title").value.trim();
      const location = document
        .getElementById("proj-location")
        .value.trim();
      const outline = document
        .getElementById("proj-outline")
        .value.trim();

      ensureUserShape(u);
      u.state.project = {
        title,
        location,
        outline,
        updatedAt: new Date().toISOString()
      };
      saveUsers(users);
      alert("프로젝트 메모가 저장되었습니다.");
      renderProject();
    });

  // -------- 광고주 --------
  function renderAds() {
    const wrap = document.getElementById("ads-list");
    const u = getCurrentUser(users);
    if (!u) {
      wrap.innerHTML =
        '<div class="notice">로그인 후 광고주 정보를 저장할 수 있습니다.</div>';
      return;
    }
    ensureUserShape(u);
    if (!u.state.ads.length) {
      wrap.innerHTML =
        '<div class="notice">등록된 광고주 정보가 없습니다.</div>';
      return;
    }
    let html =
      '<table class="table-like"><thead><tr><th>광고주</th><th>연락처</th><th>메모</th></tr></thead><tbody>';
    u.state.ads.forEach((a) => {
      html +=
        "<tr><td>" +
        (a.name || "") +
        "</td><td>" +
        (a.contact || "") +
        "</td><td>" +
        (a.note || "") +
        "</td></tr>";
    });
    html += "</tbody></table>";
    wrap.innerHTML = html;
  }

  document
    .getElementById("form-ads")
    .addEventListener("submit", (e) => {
      e.preventDefault();
      const u = requireLogin();
      if (!u) return;

      const name = document.getElementById("ads-name").value.trim();
      const contact = document
        .getElementById("ads-contact")
        .value.trim();
      const note = document.getElementById("ads-note").value.trim();

      ensureUserShape(u);
      u.state.ads.push({
        name,
        contact,
        note,
        createdAt: new Date().toISOString()
      });
      saveUsers(users);
      alert("광고주 정보가 저장되었습니다.");
      document.getElementById("form-ads").reset();
      renderAds();
    });

  // -------- 마이페이지 --------
  function renderMyPage() {
    const summary = document.getElementById("mypage-summary");
    const coinsWrap = document.getElementById("coin-table-wrap");
    const blocksBox = document.getElementById("mypage-blocks");

    const u = getCurrentUser(users);
    if (!u) {
      summary.innerHTML = "로그인 후 이용해 주세요.";
      coinsWrap.innerHTML = "";
      blocksBox.textContent = "";
      return;
    }
    ensureUserShape(u);

    const s = u.state;
    const totalCoins = s.coins.reduce((sum, c) => sum + c.amount, 0);

    summary.innerHTML =
      "<strong>" +
      (u.name || u.id) +
      "</strong> 님의 요약<br>" +
      "· 등록된 매물: " +
      s.trades.length +
      "건<br>" +
      "· 바꿔 살아 보기 제안: " +
      s.swaps.length +
      "건<br>" +
      "· 생성된 블록: " +
      s.blocks.length +
      "개<br>" +
      "· 보유 코인 합계: <strong>" +
      totalCoins +
      " 코인</strong>";

    if (!s.coins.length) {
      coinsWrap.innerHTML =
        '<div class="notice">아직 발행된 코인이 없습니다.</div>';
    } else {
      let html =
        '<table class="table-like"><thead><tr><th>코인 ID</th><th>종류</th><th>수량</th><th>연결된 블록 해시</th><th>발행 시각</th></tr></thead><tbody>';
      s.coins.forEach((c) => {
        html +=
          "<tr><td>" +
          c.id +
          "</td><td>" +
          c.type +
          "</td><td>" +
          c.amount +
          "</td><td>" +
          c.blockHash +
          "</td><td>" +
          c.createdAt +
          "</td></tr>";
      });
      html += "</tbody></table>";
      coinsWrap.innerHTML = html;
    }

    if (!s.blocks.length) {
      blocksBox.textContent = "생성된 블록이 없습니다.";
    } else {
      let out = "";
      s.blocks.forEach((b) => {
        out +=
          "[" +
          b.index +
          "] " +
          b.type.toUpperCase() +
          " | " +
          b.timestamp +
          "\n";
        out += "  hash: " + b.hash + "\n";
        out += "  prev: " + b.prevHash + "\n\n";
      });
      blocksBox.textContent = out;
    }
  }
</script>
</body>
</html>
